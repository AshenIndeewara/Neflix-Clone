<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Plans</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #141414 0%, #000000 100%);
      color: white;
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      text-align: center;
    }

    .header {
      margin-bottom: 60px;
    }

    .header h1 {
      font-size: 3.2rem;
      font-weight: 600;
      margin-bottom: 16px;
      background: linear-gradient(90deg, #e50914, #ff6b35);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header p {
      font-size: 1.3rem;
      color: #999;
      font-weight: 400;
    }

    .plans-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .plan-card {
      background: linear-gradient(145deg, #1f1f1f, #2a2a2a);
      border-radius: 16px;
      padding: 40px 30px;
      position: relative;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      overflow: hidden;
    }

    .plan-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, #e50914, #ff6b35);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }

    .plan-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(229, 9, 20, 0.3);
    }

    .plan-card:hover::before {
      opacity: 0.1;
    }

    .plan-card.featured {
      border: 2px solid #e50914;
      transform: scale(1.05);
    }

    .plan-card.featured::after {
      content: 'MOST POPULAR';
      position: absolute;
      top: 16px;
      right: 16px;
      background: linear-gradient(90deg, #e50914, #ff6b35);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 1px;
    }

    .plan-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: white;
    }

    .plan-price {
      font-size: 2.2rem;
      font-weight: 800;
      margin-bottom: 8px;
      background: linear-gradient(90deg, #e50914, #ff6b35);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .plan-period {
      color: #999;
      font-size: 1rem;
      margin-bottom: 32px;
    }

    .plan-features {
      list-style: none;
      margin-bottom: 40px;
      text-align: left;
    }

    .plan-features li {
      padding: 8px 0;
      color: #ccc;
      position: relative;
      padding-left: 24px;
    }

    .plan-features li::before {
      content: 'âœ“';
      position: absolute;
      left: 0;
      color: #e50914;
      font-weight: bold;
    }

    .pay-button {
      width: 100%;
      background: linear-gradient(90deg, #e50914, #ff6b35);
      border: none;
      color: white;
      padding: 16px 32px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .pay-button:hover {
      background: linear-gradient(90deg, #d40813, #e55a2b);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(229, 9, 20, 0.4);
    }

    .pay-button:active {
      transform: translateY(0);
    }

    .security-badge {
      margin-top: 50px;
      color: #666;
      font-size: 0.9rem;
    }

    .security-badge::before {
      content: 'ðŸ”’';
      margin-right: 8px;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 2.4rem;
      }

      .header p {
        font-size: 1.1rem;
      }

      .plans-container {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .plan-card.featured {
        transform: none;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>Choose Your Plan</h1>
      <p>Unlock unlimited access with our flexible subscription options</p>
    </div>

    <div class="plans-container">
      <!-- Basic Plan -->
      <div class="plan-card">
        <h3 class="plan-title">Basic</h3>
        <div class="plan-price">500 LKR</div>
        <div class="plan-period">per month</div>
        <ul class="plan-features">
          <li>HD Quality</li>
          <li>1 Screen</li>
          <li>Mobile & Tablet</li>
          <li>Basic Support</li>
        </ul>
        <button class="pay-button" onclick="makePayment('Basic', 500)">
          Get Basic
        </button>
      </div>

      <!-- Standard Plan (Featured) -->
      <div class="plan-card featured">
        <h3 class="plan-title">Standard</h3>
        <div class="plan-price">1000 LKR</div>
        <div class="plan-period">per month</div>
        <ul class="plan-features">
          <li>Full HD Quality</li>
          <li>2 Screens</li>
          <li>All Devices</li>
          <li>Priority Support</li>
          <li>Offline Downloads</li>
        </ul>
        <button class="pay-button" onclick="makePayment('Standard', 1000)">
          Get Standard
        </button>
      </div>

      <!-- Premium Plan -->
      <div class="plan-card">
        <h3 class="plan-title">Premium</h3>
        <div class="plan-price">1500 LKR</div>
        <div class="plan-period">per month</div>
        <ul class="plan-features">
          <li>4K Ultra HD</li>
          <li>4 Screens</li>
          <li>All Devices</li>
          <li>24/7 Premium Support</li>
          <li>Unlimited Downloads</li>
          <li>Exclusive Content</li>
        </ul>
        <button class="pay-button" onclick="makePayment('Premium', 1500)">
          Get Premium
        </button>
      </div>
    </div>

    <div class="security-badge">
      Secure payment processing with SSL encryption
    </div>
  </div>

  <script type="text/javascript" src="https://www.payhere.lk/lib/payhere.js"></script>

  <script>
    async function getClerkToken() {
      if (!window.Clerk) {
        console.error("Clerk not loaded!");
        return null;
      }

      await window.Clerk.load();
      const session = window.Clerk.session;

      if (!session) {
        window.location.href = "login.html";
        return null;
      }

      // Get token with custom template that includes role
      return await session.getToken({
        template: "Custom_Claims" // This matches the template name you created in Clerk Dashboard
      });
    }
    async function makePayment(plan, amount) {
      try {
        const token = await getClerkToken();
        console.log("Token:", token);
        const response = await fetch('https://netflix-ldox1.sevalla.app/v1/api/payments', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({
            plan: plan,
            amount: amount,
            currency: "LKR"
          })
        });

        if (!response.ok) throw new Error('Failed to create payment');

        const data = await response.json();
        console.log("Payment created:", data);

        const payment = {
          sandbox: true,
          merchant_id: "1225478",
          return_url: "https://ashenindeewara.space/payment-success.html",
          cancel_url: "https://ashenindeewara.space/payment-failed.html",
          notify_url: "https://neflix-clone-1ty8s.sevalla.app/public/notify",
          order_id: data.orderId,
          items: plan + " Plan",
          amount: amount,
          hash: data.signature,
          currency: "LKR",
          first_name: "Test",
          last_name: "User",
          email: data.email,
          phone: "0771234567",
          address: "Colombo",
          city: "Colombo",
          country: "Sri Lanka"
        };

        payhere.onCompleted = function onCompleted(orderId) {
          console.log("Payment completed. OrderID:", orderId);
          window.location.href = `payment-success.html?order_id=${orderId}&status=paid`;
        };

        payhere.onDismissed = function onDismissed() {
          console.log("Payment popup dismissed");
          window.location.href = `payment-failed.html?order_id=${orderId}&status=cancelled`;
        };

        payhere.onError = function onError(error) {
          console.error("Payment error:", error);
          window.location.href = `payment-failed.html?order_id=${orderId}&status=cancelled`;
        };

        payhere.startPayment(payment);

      } catch (err) {
        console.error("Payment error:", err);
        alert("Payment failed! Check console for details.");
      }
    }
    // Initialize Clerk and load movies
    function initClerk() {
      if (!window.Clerk) {
        console.error("Clerk script not loaded yet!");
        return;
      }
      Clerk.load();
    }
  </script>
  <!-- Clerk Script -->
  <script async crossorigin="anonymous"
    data-clerk-publishable-key="pk_test_dG9wLWdhbm5ldC05Mi5jbGVyay5hY2NvdW50cy5kZXYk"
    src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js" onload="initClerk()">
    </script>

</body>

</html>